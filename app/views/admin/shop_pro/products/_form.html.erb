
<% url = @product.new_record? ? admin_shop_pro_products_path : admin_shop_pro_product_path(@product) %>
<% method = @product.new_record? ? :post : :put %>

<div class="shop-pro-admin">
  <h2><%= @product.new_record? ? I18n.t("shop_pro.admin.new_product") : I18n.t("shop_pro.admin.edit_product") %></h2>
  <%= form_tag url, method: method, multipart: true do %>
    <div class="control-group">
      <label>标题</label>
      <%= text_field_tag "product[title]", @product.title, class: "input-xxlarge" %>
    </div>

    <div class="control-group">
      <label>价格（分）</label>
      <%= number_field_tag "product[price_cents]", @product.price_cents || 0 %>
      <label>货币</label>
      <%= text_field_tag "product[currency]", @product.currency || SiteSetting.shop_currency %>
    </div>

    <div class="control-group">
      <label>主图</label>
      <% if @product.main_image_url.present? %>
        <div><img src="<%= @product.main_image_url %>" class="img-preview"></div>
      <% end %>
      <%= file_field_tag "product[main_image]" %>
    </div>

    <div class="control-group">
      <label>图集（粘贴上传后的图片URL，每行一个）</label>
      <%= text_area_tag "product[gallery_image_urls][]", (@product.gallery_image_urls || []).join("\n"), class: "input-xxlarge", rows: 4 %>
    </div>

    <div class="control-group">
      <label>描述</label>
      <%= text_area_tag "product[description]", @product.description, class: "input-xxlarge", rows: 6 %>
    </div>

    <div class="control-group">
      <label>绑定话题 ID（可选）</label>
      <%= number_field_tag "product[topic_id]", @product.topic_id %>
    </div>

    <div class="control-group">
      <label>上架</label>
      <%= check_box_tag "product[published]", "1", @product.published %>
    </div>

    <div class="form-actions">
      <%= submit_tag I18n.t("shop_pro.admin.save"), class: "btn btn-primary" %>
      <a class="btn" href="<%= admin_shop_pro_products_path %>">返回</a>
    </div>
  <% end %>

  <% unless @product.new_record? %>
    <hr>
    <h3><%= I18n.t("shop_pro.admin.variants") %></h3>
    <table class="table">
      <thead><tr><th>SKU</th><th>价格（分）</th><th>库存</th><th></th></tr></thead>
      <tbody>
        <% @product.variants.each do |v| %>
          <tr>
            <td><%= v.sku %></td>
            <td><%= v.price_cents %></td>
            <td><%= v.stock %></td>
            <td class="actions">
              <%= form_tag admin_shop_pro_product_variant_path(@product, v), method: :put do %>
                <input type="text" name="variant[sku]" value="<%= v.sku %>" placeholder="SKU">
                <input type="number" name="variant[price_cents]" value="<%= v.price_cents %>" placeholder="Price cents">
                <input type="number" name="variant[stock]" value="<%= v.stock %>" placeholder="Stock">
                <button class="btn btn-primary" type="submit">更新</button>
              <% end %>
              <a class="btn btn-danger" data-method="delete" data-confirm="Delete?" href="<%= admin_shop_pro_product_variant_path(@product, v) %>">删除</a>
            </td>
          </tr>
        <% end %>
        <tr>
          <td colspan="4">
            <%= form_tag admin_shop_pro_product_variants_path(@product), method: :post do %>
              <strong><%= I18n.t("shop_pro.admin.add_variant") %>：</strong>
              <input type="text" name="variant[sku]" placeholder="SKU">
              <input type="number" name="variant[price_cents]" placeholder="Price cents">
              <input type="number" name="variant[stock]" placeholder="Stock">
              <button class="btn btn-primary" type="submit">新增</button>
            <% end %>
          </td>
        </tr>
      </tbody>
    </table>
  <% end %>
</div>
